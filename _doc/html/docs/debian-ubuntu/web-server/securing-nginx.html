<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Securing NGINX &mdash; Software Install Guides 7.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="canonical" href="https://docs.jpcdi.com/docs/debian-ubuntu/web-server/securing-nginx.html" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=efe5be6f"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="DDClient [DDCLIENT-Source]" href="ddclient.html" />
    <link rel="prev" title="NGINX Basic Password Auth" href="nginx-basic-auth.html" />
 
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'G-N74JQEKLQN']);
  _gaq.push(['_trackPageview']);
</script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Software Install Guides
              <img src="../../../_static/JPLogo-Header.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Debian / Ubuntu</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../apt-dpkg/index.html">APT or DPKG</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../apt-dpkg/adding-apt-list.html">Adding Extra apt-get Lists</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../apt-dpkg/adding-apt-list.html#the-apt-key-deprecated-fiasco">The <cite>apt-key</cite> deprecated fiasco</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apt-dpkg/adding-apt-list.html#release-specific-lists">Release-Specific Lists</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apt-dpkg/adding-apt-list.html#ppa">PPA</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apt-dpkg/adding-apt-list.html#personal-standards">Personal Standards</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../apt-dpkg/apt-repo.html">Personal APT Repo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apt-dpkg/dpkg-package-states.html">dpkg -l Package States</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../apt-dpkg/dpkg-package-states.html#definitions">Definitions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../apt-dpkg/insert-os-edition-name.html">OS Edition Name</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apt-dpkg/dpkg-or-apt-general-errors.html">DPKG or APT General Errors</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../apt-dpkg/dpkg-or-apt-general-errors.html#statoverride-file">StatOverride File</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Web Server Stuff</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="nginx-from-ubuntu-ppa.html">NGINX from PPA</a><ul>
<li class="toctree-l4"><a class="reference internal" href="nginx-from-ubuntu-ppa.html#nginx-s-ppa">NGINX’s PPA</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="nginx-from-source.html">Compiling NGINX From Source <span>[NGINX-Copied]</span></a><ul>
<li class="toctree-l4"><a class="reference internal" href="nginx-from-source.html#add-nginx-ppa">Add NGINX PPA</a></li>
<li class="toctree-l4"><a class="reference internal" href="nginx-from-source.html#download-source-packages">Download Source Packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="nginx-from-source.html#install-nginx">Install NGINX</a></li>
<li class="toctree-l4"><a class="reference internal" href="nginx-from-source.html#block-nginx-from-auto-update">Block NGINX from Auto-Update</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="nginx-basic-auth.html">NGINX Basic Password Auth</a><ul>
<li class="toctree-l4"><a class="reference internal" href="nginx-basic-auth.html#htpasswd"><code class="docutils literal notranslate"><span class="pre">htpasswd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="nginx-basic-auth.html#auth-pam">Auth Pam</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Securing NGINX</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#basic-https-setup">Basic HTTPS Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optimizing-nginx-s-secure-connection">Optimizing NGINX’s Secure Connection</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration-example">Configuration Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ddclient.html">DDClient <span>[DDCLIENT-Source]</span></a><ul>
<li class="toctree-l4"><a class="reference internal" href="ddclient.html#preface">Preface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="wildcard-certbot.html">Certbot WildCard SSL Cert</a><ul>
<li class="toctree-l4"><a class="reference internal" href="wildcard-certbot.html#installation">Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="wildcard-certbot.html#setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="wildcard-certbot.html#running-certbot">Running Certbot</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../extras/index.html">Extra Items</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../extras/lvm.html">LVM How To</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../extras/lvm.html#old-hard-drive">Old Hard Drive?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../extras/lvm.html#cleaned-hard-drive">Cleaned Hard Drive</a></li>
<li class="toctree-l4"><a class="reference internal" href="../extras/lvm.html#lvm-commands">LVM Commands</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../extras/mount-drive-ubuntu.html">Mounting Unformatted Drive in Ubuntu</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../extras/mount-drive-ubuntu.html#install-create-the-drive">Install/Create the Drive</a></li>
<li class="toctree-l4"><a class="reference internal" href="../extras/mount-drive-ubuntu.html#finding-the-drive">Finding the Drive</a></li>
<li class="toctree-l4"><a class="reference internal" href="../extras/mount-drive-ubuntu.html#create-partitions">Create Partitions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../extras/mount-drive-ubuntu.html#write-partitions">Write Partitions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../extras/mount-drive-ubuntu.html#partprobe">Partprobe</a></li>
<li class="toctree-l4"><a class="reference internal" href="../extras/mount-drive-ubuntu.html#format">Format</a></li>
<li class="toctree-l4"><a class="reference internal" href="../extras/mount-drive-ubuntu.html#mount-point">Mount Point</a></li>
<li class="toctree-l4"><a class="reference internal" href="../extras/mount-drive-ubuntu.html#after-mount">After Mount</a></li>
<li class="toctree-l4"><a class="reference internal" href="../extras/mount-drive-ubuntu.html#permanent-mounting">Permanent Mounting</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../extras/postfix.html">Using Postfix as Mail Relay</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../extras/postfix.html#install-postfix">Install Postfix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../extras/postfix.html#configure-postfix">Configure Postfix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../extras/postfix.html#restart-postfix">Restart Postfix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../extras/postfix.html#send-test-emails">Send Test Emails</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../extras/renaming-network-devices.html">Renaming Network Devices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../extras/renaming-network-devices.html#how-to">How To</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../extras/access-control-lists.html">Access Control Lists</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../extras/access-control-lists.html#default-permissions">Default Permissions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../extras/access-control-lists.html#tl-dr">tl;dr</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ubuntu_user.html">User Management</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../raspberry-pi/index.html">Raspberry Pi</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../raspberry-pi/boot-from-usb.html">Boot your Raspberry Pi from an External USB</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../raspberry-pi/boot-from-usb.html#first-steps">First Steps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../raspberry-pi/boot-from-usb.html#debian-raspberry-pi-os-s">Debian/Raspberry Pi OS’s</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../raspberry-pi/ddrescue.html">DDRescue</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../raspberry-pi/ddrescue.html#installing">Installing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../raspberry-pi/ddrescue.html#how-is-it-used">How is it Used?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../raspberry-pi/ddrescue.html#break-it-down">Break it Down</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../raspberry-pi/OLD-boot-from-usb.html">OLD Boot Raspberry Pi from USB</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../raspberry-pi/OLD-boot-from-usb.html#find-the-usb-drive">Find the USB Drive</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../raspberry-pi/OLD-boot-from-usb.html#install-adafruit-s-usb-program">Install Adafruit’s USB Program</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../raspberry-pi/OLD-boot-from-usb.html#adafruit-s-apt-get-repo-script">Adafruit’s <code class="docutils literal notranslate"><span class="pre">apt-get</span></code> Repo Script</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../raspberry-pi/OLD-boot-from-usb.html#adafruit-s-repo-the-long-way-round">Adafruit’s Repo the Long Way Round</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../raspberry-pi/OLD-boot-from-usb.html#installing-usb-program">Installing USB Program</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../raspberry-pi/OLD-boot-from-usb.html#running-the-program">Running the Program</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../raspberry-pi/OLD-boot-from-usb.html#after-running">After Running</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../raspberry-pi/OLD-boot-from-usb.html#fstab">fstab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../raspberry-pi/OLD-boot-from-usb.html#sd-card-info">SD Card Info</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../raspberry-pi/OLD-boot-from-usb.html#running-df-h">Running <code class="docutils literal notranslate"><span class="pre">df</span> <span class="pre">-h</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../raspberry-pi/OLD-boot-from-usb.html#recovering-from-a-failed-boot">Recovering from a Failed Boot</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../macOS/index.html">macOS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../macOS/macOS-xcode-update.html">Updating X-Code After Big Updates</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../macOS/macOS-xcode-update.html#tl-dr">tl;dr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../macOS/macOS-xcode-update.html#the-story">The Story</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../macOS/Download-Xcode-with-wget.html">Download Beta Xcode with <code class="docutils literal notranslate"><span class="pre">wget</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../macOS/Download-Xcode-with-wget.html#how-to">How To</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../macOS/Download-Xcode-with-wget.html#unzipping">Unzipping</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../macOS/Other-Random-Tidbits.html">Other Random Tidbits</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../macOS/Other-Random-Tidbits.html#local-webpage-wont-load-anywhere">Local WebPage Wont Load Anywhere!!!</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../virtualbox/index.html">VirtualBox</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../virtualbox/virtualbox-autostart.html">VirtualBox AutoStart</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../virtualbox/virtualbox-autostart.html#autostart-systems">AutoStart Systems</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../virtualbox/virtualbox-autostart.html#linux">Linux</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../virtualbox/virtualbox-autostart.html#macos">macOS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../virtualbox/virtualbox-autostart.html#autostart-cfg-file">AutoStart.cfg File</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../virtualbox/virtualbox-autostart.html#linux-autostart">Linux Autostart</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../virtualbox/virtualbox-autostart.html#macos-autostart">macOS Autostart</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../virtualbox/virtualbox-autostart.html#file-permissions">File Permissions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../virtualbox/virtualbox-autostart.html#linux-file-permissions">Linux File Permissions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../virtualbox/virtualbox-autostart.html#macos-file-permissions">macOS File Permissions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../virtualbox/virtualbox-autostart.html#vboxmanage-modifyvm"><code class="docutils literal notranslate"><span class="pre">VBoxManage</span> <span class="pre">modifyvm</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../virtualbox/virtualbox-autostart.html#testing">Testing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../virtualbox/virtualbox-autostart.html#id3">Linux</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../virtualbox/virtualbox-autostart.html#id4">macOS</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../virtualbox/virtualbox-guest-addition.html">VirtualBox Guest Additions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../virtualbox/virtualbox-guest-addition.html#host-machine">Host Machine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../virtualbox/virtualbox-guest-addition.html#ubuntu-server-guest-machine">Ubuntu Server Guest Machine</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../virtualbox/virtualbox-guest-addition.html#pre-requirements">Pre-Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../virtualbox/virtualbox-guest-addition.html#mount-the-cdrom">Mount the CDROM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../virtualbox/virtualbox-guest-addition.html#run-the-installer">Run the Installer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../virtualbox/virtualbox-guest-addition.html#usermod"><code class="docutils literal notranslate"><span class="pre">usermod</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../virtualbox/virtualbox-guest-addition.html#services-info">Services Info</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../virtualbox/virtualbox-systemd.html">VirtualBox Systemd</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../general-bash/index.html">General Bash</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../general-bash/bash-if-conditionals.html">Bash Conditional Expressions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../general-bash/bash-if-conditionals.html#breakdown">Breakdown</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../general-bash/bash-if-conditionals.html#conditional-expression-primaries">Conditional Expression Primaries</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../general-bash/bash-logging.html">Bash Logging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../general-bash/bash-logging.html#what-does-it-do">What does it do?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../general-bash/basic-linux.html">Some Basic Linux Commands</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../general-bash/basic-linux.html#ssh-or-remote-use">SSH or Remote Use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../general-bash/basic-linux.html#ssh-keys">SSH Keys</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../general-bash/basic-linux.html#ssh-key-generate">SSH-Key Generate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../general-bash/basic-linux.html#ssh-key-location">SSH Key Location</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../general-bash/basic-linux.html#ssh-copy-id-or-sending-your-public-key">SSH-Copy-ID or Sending Your Public Key</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../general-bash/basic-linux.html#restarting-the-machine">Restarting the Machine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../general-bash/basic-linux.html#updating-the-apps">Updating the Apps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../general-bash/basic-linux.html#bash-logging">Bash Logging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../general-bash/basic-linux.html#what-does-it-do">What does it do?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../general-bash/basic-linux.html#deprecation-of-apt-key">Deprecation of <code class="docutils literal notranslate"><span class="pre">apt-key</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../general-bash/basic-linux.html#using-dd-for-backup">Using DD for Backup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../general-bash/basic-grep-usage.html">Use grep Output as if-else Conditional</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../general-bash/basic-grep-usage.html#basic-use-of-grep-in-if-else">Basic Use of grep in if-else</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../general-bash/basic-grep-usage.html#so-lets-break-that-down">So, lets break that down</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../general-bash/here-docs.html">Here Docs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../general-bash/pip-requirements-file.html">pip Requirements File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../general-bash/random-collection-of-info.html">Random Collection of Info</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../general-bash/random-collection-of-info.html#using-find-to-chmod-multiple-files">Using <code class="docutils literal notranslate"><span class="pre">find</span></code> to <code class="docutils literal notranslate"><span class="pre">chmod</span></code> multiple files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../general-bash/random-collection-of-info.html#break-down">Break Down</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../general-bash/random-collection-of-info.html#using-awk-to-modify-output">Using <code class="docutils literal notranslate"><span class="pre">awk</span></code> to Modify Output</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../general-bash/random-collection-of-info.html#remove-text-like-commas">Remove text, like Commas</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../general-bash/random-collection-of-info.html#breakdown">Breakdown</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../general-bash/random-collection-of-info.html#using-as-new-lines">Using <code class="docutils literal notranslate"><span class="pre">\</span></code> as New Lines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../general-bash/random-collection-of-info.html#shell-script-location">Shell Script Location</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../general-bash/random-collection-of-info.html#random-number-generator">Random Number Generator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../general-bash/random-collection-of-info.html#details">Details</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../general-bash/random-collection-of-info.html#using-sed-to-make-updates">Using <code class="docutils literal notranslate"><span class="pre">sed</span></code> to Make Updates</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../general-bash/signals-and-traps.html">Signals and Traps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../general-bash/optional-parameter.html">Default Optional Agruments</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../git/index.html">Git</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../git/git-repo-address.html">Local Git Repo Address</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../git/git-repo-address.html#viewing-the-repo-s-address">Viewing the Repo’s Address</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../git/git-repo-address.html#background">Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../git/git-repo-address.html#changing-the-address">Changing The Address</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../git/git-repo-address.html#code-breakdown">Code Breakdown</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../git/git-repo-address.html#final-steps">Final Steps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../git/cache-git-password-terminal.html">Saving your Git Repo Password</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../git/cache-git-password-terminal.html#or">OR</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../git/cache-git-password-terminal.html#macos">macOS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../git/git_orphan.html">Git –orphan</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../website-testing/index.html">Website Testing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../website-testing/testing-services.html">Testing your Web Server Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../website-testing/testing-services.html#list">List</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../extras/index.html">Extras</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../extras/random-ansible-snippets.html">Random Ansible Snippets</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../extras/random-ansible-snippets.html#ansible-cli-basic-example">Ansible CLI - Basic Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../extras/random-ansible-snippets.html#pass-a-list">Pass a List</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../extras/ansible-random-nuggets.html">Ansible Random Nuggets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../extras/mysql-767-error-code.html">Fixing mysql/mariaDB 767 Character Error Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../extras/mysql-767-error-code.html#tl-dr">tl;dr</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../homelabChangelog/index.html">HomeLab Change Log</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../homelabChangelog/standard-changes.html">Standard Changes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../homelabChangelog/standard-changes.html#after-installation">After Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../homelabChangelog/standard-changes.html#ssh-keys">SSH Keys</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../homelabChangelog/standard-changes.html#ansible">Ansible</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Older, now unused how to's</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../archive/index.html">Archive</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../archive/downloader/index.html">Archived Downloaders</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../archive/downloader/transmission-daemon.html">Transmission <span>[TRANS-HTPC]</span></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../archive/downloader/transmission-daemon.html#add-repo-and-install">Add Repo and Install</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/downloader/transmission-daemon.html#user-group-account-modifications">User/Group Account Modifications</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/downloader/transmission-daemon.html#editing-the-settings-conf-file">Editing the <code class="docutils literal notranslate"><span class="pre">settings.conf</span></code> File</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../archive/downloader/transmission-web-gui.html">Alternate Transmission Web GUI</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../archive/downloader/transmission-web-gui.html#using-kettu-s-web-gui-for-transmission">Using Kettu’s Web GUI for Transmission</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/downloader/transmission-web-gui.html#transmission-web-gui-file-locations">Transmission Web GUI File Locations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../archive/downloader/openvpn.html">OpenVPN <span>[PIA-VPN]</span></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../archive/downloader/openvpn.html#secure-downloading">Secure Downloading</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/downloader/openvpn.html#info">Info</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/downloader/openvpn.html#install">Install</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/downloader/openvpn.html#pia-openvpn-files">PIA OpenVPN Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/downloader/openvpn.html#copy-the-files">Copy the Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/downloader/openvpn.html#create-the-login-file">Create the Login File</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/downloader/openvpn.html#edit-the-config-file">Edit the Config File</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/downloader/openvpn.html#test-vpn">Test VPN</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/downloader/openvpn.html#setup-openvpn-s-autostart-configuration">Setup OpenVPN’s Autostart Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../archive/downloader/nzbget.html">NZBGet <span>[NZBGet-HTPC]</span></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../archive/downloader/nzbget.html#unrar">UnRar</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/downloader/nzbget.html#nzbget-installation">NZBGet Installation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../archive/webapps/index.html">WebApps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../archive/webapps/radarr.html">Radarr Movie Downloader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../archive/webapps/couchpotato.html">CouchPotato Movie Downloader <span>[HTPC-CP]</span></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../archive/webapps/couchpotato.html#shoutout">Shoutout</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/webapps/couchpotato.html#base-requirements">Base Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/webapps/couchpotato.html#clone-the-repo">Clone the Repo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/webapps/couchpotato.html#test-if-it-works">Test if it Works</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/webapps/couchpotato.html#copy-edit-default-file">Copy/Edit Default File</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/webapps/couchpotato.html#copy-or-edit-the-init-d-file">Copy or Edit the init.d File</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../archive/webapps/tautulli.html">Tautulli (previously PlexPy) <span>[HTPC-Tautulli]</span></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../archive/webapps/tautulli.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/webapps/tautulli.html#clone-the-repo">Clone the Repo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/webapps/tautulli.html#edit-the-default-file">Edit the Default File</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/webapps/tautulli.html#create-tautulli-user">Create Tautulli User</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/webapps/tautulli.html#change-ownerships-and-symlink">Change Ownerships and Symlink</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/webapps/tautulli.html#testing-the-program-first">Testing the Program First</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/webapps/tautulli.html#autostart-system-files">AutoStart System Files</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../archive/webapps/sonarr.html">Sonarr Installation <span>[HTPC-Sonarr]</span></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../archive/webapps/sonarr.html#base-requirements">Base Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/webapps/sonarr.html#add-the-apt-source-and-install">Add the Apt Source and Install</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/webapps/sonarr.html#first-run">First Run</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/webapps/sonarr.html#create-autostart-init-d-file">Create Autostart init.d File</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/webapps/sonarr.html#add-to-autostart-program">Add to Autostart Program</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../archive/webapps/sonarr.html#final-steps">Final Steps</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../archive/general-bash/index.html">Archived General Bash</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../archive/general-bash/ratom.html">Ratom <span>[RATOM-src]</span></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../archive/general-bash/ratom.html#archival">Archival</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Software Install Guides</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Debian / Ubuntu</a></li>
          <li class="breadcrumb-item"><a href="index.html">Web Server Stuff</a></li>
      <li class="breadcrumb-item active">Securing NGINX</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/docs/debian-ubuntu/web-server/securing-nginx.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="nginx-basic-auth.html" class="btn btn-neutral float-left" title="NGINX Basic Password Auth" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ddclient.html" class="btn btn-neutral float-right" title="DDClient [DDCLIENT-Source]" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="securing-nginx">
<h1>Securing NGINX<a class="headerlink" href="#securing-nginx" title="Link to this heading"></a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These directions are way out of date. Do not use these!
I have since switched to a different process or tool since writing this particular article, but keeping it up for posterities sake, until I can properly replace it.</p>
</div>
<p>What have I changed to you ask?
Anything building I’ve tried switching over to Ansible to handle in a much more programatic way.
Others might be tools that I just don’t use at all anymore, due to changing DNS hosts.</p>
<p>This is a high level, very basic, more of a “config-only” document. There will be other docs that better explain the items listed here.</p>
<p>One big, generalized note to keep in mind is each line ends with <code class="docutils literal notranslate"><span class="pre">;</span></code></p>
<p>These following steps are almost singularly taken from <a class="reference external" href="https://www.bjornjohansen.com/">Bjornjohansen</a>  website. His <a class="reference external" href="https://www.bjornjohansen.com/tag/nginx">NGINX Configuration</a> how-to’s were the singular guides I used for securing my setup. I cannot recommend his website more!</p>
<section id="basic-https-setup">
<h2>Basic HTTPS Setup<a class="headerlink" href="#basic-https-setup" title="Link to this heading"></a></h2>
<section id="obtaining-the-certificate">
<h3>Obtaining the Certificate<a class="headerlink" href="#obtaining-the-certificate" title="Link to this heading"></a></h3>
<p>First off, in order to actually have a secure connection to a website, that website has to have a trusted certificate. Its fine and dandy for you to be your own Certificate Authority, or CA, if only you or people who will trust your certs will access your site. If you want anyone else ever to access your site, services or apps, you need to use an already-trusted CA. Of which, you no longer have to pay for this, if you so choose.</p>
<p>Enter <a class="reference external" href="https://certbot.eff.org/">CertBot</a>. They are a means of having a free, short term certificate that is SO SO SO much easier to install than almost any other CA I’ve ever found. Though, the main downside being that its only valid for 3 months (other CA’s offer for much much longer), but it being BOTH free and easy is world-shattering in how long it took for this to occur.</p>
<p>The system works, at least in the way I use it, by creating a temporary webserver itself, then trying to access said webserver through the address you’ve requested a cert for. As in, your web address has to be pointing to the machine running the certbot server at that time.</p>
<p>Then, once it validates that info, it creates the cert, registers it with the Acme CA (their CA repo that they use/created) and instantly, your website’s secure certs are trusted by browsers everywhere, due to the Acme CA being a registered and trusted CA.</p>
<p>The options are wide and varied, but the way I use it is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/
wget<span class="w"> </span>https://dl.eff.org/certbot-auto
chmod<span class="w"> </span>a+x<span class="w"> </span>certbot-auto
sudo<span class="w"> </span>nginx<span class="w"> </span>-s<span class="w"> </span>stop
./certbot-auto<span class="w"> </span>certonly
</pre></div>
</div>
<p>Then follow the prompts. Make sure nothing is hogging the ports <code class="docutils literal notranslate"><span class="pre">80</span></code> or <code class="docutils literal notranslate"><span class="pre">443</span></code>, as thats what certbot’s server uses to authorize you.</p>
<p>You’ll also see letsencrypt floating around, that was the original name, and is the parent projects name.</p>
<p>Take note of the location of the saved certs.</p>
</section>
<section id="server-redirect">
<h3>Server Redirect<a class="headerlink" href="#server-redirect" title="Link to this heading"></a></h3>
<p>To default-direct all requests to the secured, 443 items, you can use the following in your <code class="docutils literal notranslate"><span class="pre">80</span></code> server section.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>server<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>listen<span class="w"> </span><span class="m">80</span><span class="w"> </span>default_server<span class="p">;</span>
<span class="w">  </span>listen<span class="w"> </span><span class="o">[</span>::<span class="o">]</span>:80<span class="w"> </span>default_server<span class="p">;</span>
<span class="w">  </span>server_name<span class="w"> </span>jpcdi.com<span class="w"> </span>www.jpcdi.com<span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="m">301</span><span class="w"> </span>https://<span class="nv">$server_name$request_uri</span><span class="p">;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">301</span> <span class="pre">https://$server_name$request_uri;</span></code> tells the requesting browser or program to use <code class="docutils literal notranslate"><span class="pre">https</span></code>, which then routes to the next server block, which is <code class="docutils literal notranslate"><span class="pre">https</span></code></p>
</section>
<section id="adding-http2">
<h3>adding <code class="docutils literal notranslate"><span class="pre">http2</span></code><a class="headerlink" href="#adding-http2" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">http2</span></code> is the new standard for the <code class="docutils literal notranslate"><span class="pre">http</span></code> protocol. This is the first update to the protocol in over 15 years, and adds important updates.</p>
<p>From their <a class="reference external" href="https://http2.github.io/faq/#what-are-the-key-differences-to-http1x">FAQs</a>:</p>
<blockquote>
<div><dl class="simple">
<dt><strong>What are the key differences to HTTP/1.x?</strong></dt><dd><p>At a high level, HTTP/2:</p>
<ul class="simple">
<li><p>is binary, instead of textual</p></li>
<li><p>is fully multiplexed, instead of ordered and blocking</p></li>
<li><p>can therefore use one connection for parallelism</p></li>
<li><p>uses header compression to reduce overhead</p></li>
<li><p>allows servers to “push” responses proactively into client caches</p></li>
</ul>
</dd>
</dl>
</div></blockquote>
<p>It is, in my opinion, a very important and necessary addition to your NGINX configuration.</p>
<p>On your 443 <code class="docutils literal notranslate"><span class="pre">listen</span></code> directives, add <code class="docutils literal notranslate"><span class="pre">http2;</span></code>, as in:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>listen<span class="w"> </span><span class="m">443</span><span class="w"> </span>default_server<span class="w"> </span>ssl<span class="w"> </span>http2<span class="p">;</span>
listen<span class="w"> </span><span class="o">[</span>::<span class="o">]</span>:<span class="w"> </span><span class="m">443</span><span class="w"> </span>default_server<span class="w"> </span>ssl<span class="w"> </span>http2<span class="p">;</span>
</pre></div>
</div>
<p>The second line being the ipv6 version of the listen directive</p>
</section>
<section id="certificate-locations-in-nginx">
<h3>Certificate Locations in NGINX<a class="headerlink" href="#certificate-locations-in-nginx" title="Link to this heading"></a></h3>
<p>There are 2 specific items you need to start.</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">ssl_certificate</span></code> and <code class="docutils literal notranslate"><span class="pre">ssl_certificate_key</span></code></p>
</div></blockquote>
<p>The <code class="docutils literal notranslate"><span class="pre">ssl_certificate</span></code> is specifically the <code class="docutils literal notranslate"><span class="pre">fullchain.pem</span></code> file that is in  the <code class="docutils literal notranslate"><span class="pre">/etc/letsencrypt/live</span></code> directory.
The <code class="docutils literal notranslate"><span class="pre">ssl_certificate_key</span></code> is the <code class="docutils literal notranslate"><span class="pre">privkey.pem</span></code> file in the same location as above.</p>
<p>Normally, with almost ANY other CA, there are a million and one steps between start and finish. Between creating accounts, paying them, downloading maybe one file and then sussing out the certificate chains, and all sorts of other things.</p>
</section>
<section id="foward-secrecy">
<h3>Foward Secrecy<a class="headerlink" href="#foward-secrecy" title="Link to this heading"></a></h3>
<p>Luckily, and most likely the ONLY, NGINX has Forward Secrecy (FS) enabled by default on its connections. So, awesome on less manual steps.</p>
</section>
</section>
<section id="optimizing-nginx-s-secure-connection">
<h2>Optimizing NGINX’s Secure Connection<a class="headerlink" href="#optimizing-nginx-s-secure-connection" title="Link to this heading"></a></h2>
<section id="connection-credentials-caching">
<h3>Connection Credentials Caching<a class="headerlink" href="#connection-credentials-caching" title="Link to this heading"></a></h3>
<p>Almost all of the overhead with SSL/TLS is during the initial connection. So, we setup caching parameters.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssl_session_cache<span class="w"> </span>shared:SSL:20m<span class="p">;</span>
ssl_session_timeout<span class="w"> </span>180m<span class="p">;</span>
</pre></div>
</div>
<dl class="simple">
<dt>From Bjornjohansen’s <a class="reference external" href="https://www.bjornjohansen.com/optimizing-https-nginx">Optimizing NGINX</a> website:</dt><dd><p>This will create a cache shared between all worker processes. The cache size is specified in bytes (in this example: 20 MB). According to the Nginx documentation, 1MB can store about 4,000 sessions, so for this example, we can store about 80,000 sessions, and we will store them for 180 minutes. If you expect more traffic, increase the cache size accordingly.</p>
</dd>
</dl>
<p>I personally use <code class="docutils literal notranslate"><span class="pre">ssl_session_cache</span> <span class="pre">shared:SSL:20m</span> <span class="pre">builtin:1000;</span></code>. You’ll notice the added <code class="docutils literal notranslate"><span class="pre">builtin</span></code> option, defined below, pulled from nginx’s website.</p>
<dl class="simple">
<dt>builtin</dt><dd><p>a cache built in OpenSSL; used by one worker process only. The cache size is specified in sessions. If size is not given, it is equal to 20480 sessions. Use of the built-in cache can cause memory fragmentation.</p>
</dd>
</dl>
</section>
<section id="ssl-protocols">
<h3>SSL Protocols<a class="headerlink" href="#ssl-protocols" title="Link to this heading"></a></h3>
<p>So, here is where we disable SSL. (?)</p>
<dl class="simple">
<dt>The reason for this:</dt><dd><p>SSL is old news, with TLS being what has replaced SSL. But, SSL is still a bit in the common vernacular to this day. SSL also has been broken through several weaknesses and is easily bypassed through protocol downgrade attacks.</p>
</dd>
</dl>
<p>The only browser left to not support TLS is IE6. Which, I personally believe if someone is still using that browser, they don’t really need my site anyways.</p>
<p>We add::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssl_protocols</span> <span class="n">TLSv1</span> <span class="n">TLSv1</span><span class="mf">.1</span> <span class="n">TLSv1</span><span class="mf">.2</span><span class="p">;</span>
</pre></div>
</div>
<p>to cite the specific secure protocols we use on our site.</p>
</section>
<section id="optimizing-the-cipher-suites">
<h3>Optimizing the Cipher Suites<a class="headerlink" href="#optimizing-the-cipher-suites" title="Link to this heading"></a></h3>
<p>The cipher suites are how the data is encrypted. We list which suites we will use with the browsers.</p>
<p>I personally use::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ssl_prefer_server_ciphers on;
ssl_ciphers ECDH+AESGCM:ECDH+AES256:ECDH+AES128:DH+3DES:!ADH:!AECDH:!MD5
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ssl_prefer_server_ciphers</span> <span class="pre">on;</span></code> is to tell the client we have a preferred order of cipher suites. Then, the list of the suites. Take a look at SSL Labs <a class="reference external" href="https://github.com/ssllabs/research/wiki/SSL-and-TLS-Deployment-Best-Practices">Deployment Best Practices</a> for detailed info on the suites.</p>
<p>For the long list they present, you can make a seperate file, save it inside your <code class="docutils literal notranslate"><span class="pre">/etc/nginx</span></code> directory, and reference it in your nginx configuration <code class="docutils literal notranslate"><span class="pre">include</span> <span class="pre">cipher_suites</span></code>, and it will use the contents of that file.</p>
</section>
<section id="generate-dh-parameters">
<h3>Generate DH Parameters<a class="headerlink" href="#generate-dh-parameters" title="Link to this heading"></a></h3>
<p>Create the DH Parameters file with 2048 bit long safe prime:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>mkdir<span class="w"> </span>/etc/nginx/cert
sudo<span class="w"> </span>openssl<span class="w"> </span>dhparam<span class="w"> </span><span class="m">2048</span><span class="w"> </span>-out<span class="w"> </span>/etc/nginx/cert/dhparam.pem
</pre></div>
</div>
<p>And add it to your config with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssl_dhparam<span class="w"> </span>/etc/nginx/cert/dhparam.pem<span class="p">;</span>
</pre></div>
</div>
</section>
<section id="enable-ocsp-stapling">
<h3>Enable OCSP Stapling<a class="headerlink" href="#enable-ocsp-stapling" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>WARNING! If you are currently trying to do any type of setup or development work internally that will be utilizing some form of your public-facing URL, like <code class="docutils literal notranslate"><span class="pre">home.your.url.com</span></code> where <code class="docutils literal notranslate"><span class="pre">home</span></code> is the internal piece, this step will throw a HUGE WRENCH into this process!! Essentially, it’ll force you to have an SSL cert on even a newly-installed application or program, because ALL web browsers will be expecting one for however long you put down in your configuration below. YOU’VE BEEN WARNED!!</p>
</div>
<p>Online Certificate Status Protocol (OCSP) is a protocol for checking the revocation status of the presented certificate. When a proper browser is presented a certificate, it will contact the issuer of that certificate to check that it hasn’t been revoked. This, of course, adds overhead to the connection initialization and also presents a privacy issue involving a 3rd party. Thus, the reason for OCSP Stapling:</p>
<p>The web server can, at regular intervals, contact the certificate authority’s OCSP server to get a signed response and staple it on to the handshake when the connection is set up. This provides for a much more efficient connection initialization and keeps the 3rd party out of the way.</p>
<p>To make sure the response from the CA is not tampered with, we also set up Nginx to verify the response using the trusted certificate provided by CertBot, which is the <code class="docutils literal notranslate"><span class="pre">chain.pem</span></code> file provided.</p>
<p>So, for the NGINX configuration:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssl_stapling<span class="w"> </span>on<span class="p">;</span>
ssl_stapling_verify<span class="w"> </span>on<span class="p">;</span>
ssl_trusted_certificate<span class="w"> </span>/etc/letsencrypt/live/jpcdi.com/chain.pem<span class="p">;</span>
resolver<span class="w"> </span><span class="m">8</span>.8.8.8<span class="w"> </span><span class="m">8</span>.8.4.4<span class="p">;</span>
</pre></div>
</div>
<p>The resolver uses whatever DNS server you specify, so NGINX can find the resolver through the internet.If you want to use another public DNS, use them.</p>
</section>
<section id="strict-transport-security">
<h3>Strict Transport Security<a class="headerlink" href="#strict-transport-security" title="Link to this heading"></a></h3>
<p>This setting tells your browser, after its attempted an unsecure connection once, will default to the secure connections only within the cached timeframe you have listed.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>add_header<span class="w"> </span>Strict-Transport-Security<span class="w"> </span><span class="s1">&#39;max-age=31536000; includeSubDomains; preload&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>The preload is if you want to add your server to the Google Maintained list of sites that are for sure secure.</p>
<p>The includeSubDomains, obviously is to include all subdomains. And I have this in my <code class="docutils literal notranslate"><span class="pre">http</span></code> block, above the <code class="docutils literal notranslate"><span class="pre">server</span></code> block.</p>
</section>
</section>
<section id="configuration-example">
<h2>Configuration Example<a class="headerlink" href="#configuration-example" title="Link to this heading"></a></h2>
<p>Here is the tl;dr configuration, with the above in one place, plus more lines from my personal config file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>http<span class="w"> </span><span class="o">{</span>

<span class="w">  </span><span class="c1"># beginning of your config file</span>

<span class="w">  </span>add_header<span class="w"> </span>Strict-Transport-Security<span class="w"> </span><span class="s1">&#39;max-age=31536000; includeSubDomains; preload&#39;</span><span class="p">;</span>
<span class="w">  </span>add_header<span class="w"> </span>X-Content-Type-Options<span class="w"> </span><span class="s2">&quot;nosniff&quot;</span><span class="w"> </span>always<span class="p">;</span>
<span class="w">  </span>add_header<span class="w"> </span>X-Frame-Options<span class="w"> </span><span class="s2">&quot;SAMEORIGIN&quot;</span><span class="w"> </span>always<span class="p">;</span>
<span class="w">  </span>add_header<span class="w"> </span>X-XSS-Protection<span class="w"> </span><span class="s2">&quot;1; mode=block&quot;</span><span class="p">;</span>
<span class="w">  </span>add_header<span class="w"> </span>X-Robots-Tag<span class="w"> </span>none<span class="p">;</span>
<span class="w">  </span>add_header<span class="w"> </span>X-Download-Options<span class="w"> </span>noopen<span class="p">;</span>
<span class="w">  </span>add_header<span class="w"> </span>X-Permitted-Cross-Domain-Policies<span class="w"> </span>none<span class="p">;</span>

<span class="w">  </span><span class="c1"># Giant sea of SSL stuff...</span>
<span class="w">  </span>ssl_session_cache<span class="w"> </span>shared:SSL:20m<span class="w"> </span>builtin:1000<span class="p">;</span>
<span class="w">  </span>ssl_session_timeout<span class="w"> </span>180m<span class="p">;</span>
<span class="w">  </span>ssl_protocols<span class="w"> </span>TLSv1<span class="w"> </span>TLSv1.1<span class="w"> </span>TLSv1.2<span class="p">;</span>

<span class="w">  </span><span class="c1"># Using list of ciphers from https://bjornjohansen.no/optimizing-https-nginx</span>
<span class="w">  </span>ssl_prefer_server_ciphers<span class="w"> </span>on<span class="p">;</span>
<span class="w">  </span>ssl_ciphers<span class="w"> </span>ECDH+AESGCM:ECDH+AES256:ECDH+AES128:DH+3DES:!ADH:!AECDH:!MD5<span class="p">;</span>

<span class="w">  </span><span class="c1"># rest of http block</span>
<span class="o">}</span>
server<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>listen<span class="w"> </span><span class="m">80</span><span class="w"> </span>default_server<span class="p">;</span>
<span class="w">  </span>listen<span class="w"> </span><span class="o">[</span>::<span class="o">]</span>:80<span class="w"> </span>default_server<span class="p">;</span>
<span class="w">  </span>server_name<span class="w"> </span>jpcdi.com<span class="w"> </span>www.jpcdi.com<span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="m">301</span><span class="w"> </span>https://<span class="nv">$server_name$request_uri</span><span class="p">;</span>
<span class="o">}</span>
server<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>listen<span class="w"> </span><span class="m">443</span><span class="w"> </span>default_server<span class="w"> </span>ssl<span class="w"> </span>http2<span class="p">;</span>
<span class="w">  </span>listen<span class="w"> </span><span class="o">[</span>::<span class="o">]</span>:443<span class="w"> </span>default_server<span class="w"> </span>ssl<span class="w"> </span>http2<span class="p">;</span>

<span class="w">  </span><span class="c1"># Letsencrypt ssl_certs and one dhparam.pem</span>
<span class="w">  </span>ssl_certificate<span class="w"> </span>/etc/letsencrypt/live/jpcdi.com/fullchain.pem<span class="p">;</span>
<span class="w">  </span>ssl_certificate_key<span class="w"> </span>/etc/letsencrypt/live/jpcdi.com/privkey.pem<span class="p">;</span>
<span class="w">  </span>ssl_dhparam<span class="w"> </span>/etc/nginx/cert/jpcdi_dhparam.pem<span class="p">;</span>

<span class="w">  </span><span class="c1"># HSTS/SSL Stapling stuff...</span>
<span class="w">  </span>ssl_stapling<span class="w"> </span>on<span class="p">;</span>
<span class="w">  </span>ssl_stapling_verify<span class="w"> </span>on<span class="p">;</span>
<span class="w">  </span>resolver<span class="w"> </span><span class="m">8</span>.8.8.8<span class="w"> </span><span class="m">8</span>.8.4.4<span class="w"> </span><span class="nv">valid</span><span class="o">=</span><span class="m">86400</span><span class="p">;</span>
<span class="w">  </span>ssl_trusted_certificate<span class="w"> </span>/etc/letsencrypt/live/jpcdi.com/chain.pem<span class="p">;</span>
<span class="o">}</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="nginx-basic-auth.html" class="btn btn-neutral float-left" title="NGINX Basic Password Auth" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ddclient.html" class="btn btn-neutral float-right" title="DDClient [DDCLIENT-Source]" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2024, Justin Partain, JPartain89, JPCDI.
      <span class="lastupdated">Last updated on July 21, 2024.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-N74JQEKLQN"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-N74JQEKLQN', {
          'anonymize_ip': false,
      });
    </script>
 
<div class="footer">This page uses <a href="https://analytics.google.com/">
Google Analytics</a> to collect statistics. You can disable it by blocking
the JavaScript coming from www.google-analytics.com.
<script>
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
</div>


</body>
</html>